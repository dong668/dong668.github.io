<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/immersed.js"></script>
	<script type="text/javascript" src="utilsJs/sha1.js"></script>
	<script type="text/javascript" src="utilsJs/utils.js"></script>
	<script type="text/javascript" src="utilsJs/httpUtils.js"></script>
	<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />
	<script type="text/javascript">
		var tphone = null;
		var tcode = null;
		// 处理点击事件
		var _openw = null;
		var img = null;
		var blist = [];
		var as = 'pop-in'; // 默认窗口动画
		function scaned(t, r, f) {
			var d = new Date();
			var h = d.getHours(),
				m = d.getMinutes(),
				s = d.getSeconds(),
				ms = d.getMilliseconds();
			if (h < 10) {
				h = '0' + h;
			}
			if (m < 10) {
				m = '0' + m;
			}
			if (s < 10) {
				s = '0' + s;
			}
			if (ms < 10) {
				ms = '00' + ms;
			} else if (ms < 100) {
				ms = '0' + ms;
			}
			var ts = '[' + h + ':' + m + ':' + s + '.' + ms + ']';
			var li = null,
				hl = document.getElementById("history");
			if (blist.length > 0) {
				li = document.createElement("li");
				li.className = "ditem";
				hl.insertBefore(li, hl.childNodes[0]);
			} else {
				li = document.getElementById("nohistory");
			}
			update(t, r, f);
		}

		function update(t, r, f) {
			outSet("扫描成功：");
			outLine(t);
			outLine(r);
			outLine("\n图片地址：" + f);
		}
		/**
		 * 验证手机号的正则表达式和位数
		 */
		function fCheckPhone() {
			tphone = document.getElementById("tphone");
			tcode = document.getElementById("tcode");
			var rPhone = /^1/;
			if (tphone.value.length == 0) {
				plus.nativeUI.toast("您必须填写手机号", {
					duration: "short"
				});
				return false;
			} else if (tphone.value.length != 11) {
				plus.nativeUI.toast("您输入的手机号位数不对", {
					duration: "short"
				});
				return false;
			} else if (!rPhone.test(tphone.value)) {
				plus.nativeUI.toast("您输入的手机号必须以1开头", {
					duration: "short"
				});
				return false;
			} else if (isNaN(tphone.value)) {
				plus.nativeUI.toast("请输入正确的手机号", {
					duration: "short"
				});
				return false;
			}
			return true;
		}
		/**
		 * 打开新界面
		 * @param {Object} id
		 * @param {Object} a
		 * @param {Object} s
		 */
		function fOpenView(id, a, s) {
			var preate = {};
			if (_openw) {
				return false;
			}
			a || (a = as); //相当于三目运算
			_openw = preate[id];
			if (_openw) {
				_openw.showded = true;
				_openw.show(a, null, function() {
					_openw = null; //避免快速点击打开多个页面
				});
			} else {
				_openw = plus.webview.create(id, id, {
					scrollIndicator: 'none',
					scalable: false,
					popGesture: 'hide'
				}, {
					preate: true
				});
				preate[id] = _openw;
				_openw.addEventListener('loaded', function() { //叶面加载完成后才显示
					//		setTimeout(function(){//延后显示可避免低端机上动画时白屏
					//			wa.close();
					_openw.showded = true;
					s || _openw.show(a, null, function() {
						_openw = null; //避免快速点击打开多个页面
					});
					s && (_openw = null); //避免s模式下变量无法重置
					//		},10);
				}, false);
				_openw.addEventListener('hide', function() {
					_openw && (_openw.showded = true);
					_openw = null;
				}, false);
				_openw.addEventListener('close', function() { //页面关闭后可再次打开
					_openw = null;
					preate[id] && (preate[id] = null); //兼容窗口的关闭
				}, false);
			}
		}
		/**
		 * 登陆
		 * @param {Object} id 当前点击的id
		 * @param {Object} a
		 * @param {Object} s
		 */
		function fClicked(id, a, s) {
			if (!fCheckPhone()) {
				return false;
			} else if (tcode.value.length <= 0) {
				plus.nativeUI.toast("输入密码不能为空", {
					duration: "short"
				});
				return false;
			}
			window.httpGet = new HttpGetAndCheckAccessToken({
				host: "http://dev.mimixiche.cn"
			});
			judgePlatform(tphone.value, tcode.value, function(responseJson) {
				var map = new Map();
				map.put('from', '0');
				map.put('count', '10');
				map.put('is_driver', '1');
				httpGet.getAccessToken('/adapi/products/orders', map, function(responseJson) {}, function(errorJson) {});
			}, function(errorJson) {});
			//			var preate = {};
			//			if (_openw) {
			//				return false;
			//			}
			//			a || (a = as); //相当于三目运算
			//			_openw = preate[id];
			//			if (_openw) {
			//				_openw.showded = true;
			//				_openw.show(a, null, function() {
			//					_openw = null; //避免快速点击打开多个页面
			//				});
			//			} else {
			//				//		var wa=plus.nativeUI.showWaiting();
			//				_openw = plus.webview.create(id, id, {
			//					scrollIndicator: 'none',
			//					scalable: false,
			//					popGesture: 'hide'
			//				}, {
			//					preate: true
			//				});
			//				preate[id] = _openw;
			//				_openw.addEventListener('loaded', function() { //叶面加载完成后才显示
			//					//		setTimeout(function(){//延后显示可避免低端机上动画时白屏
			//					//			wa.close();
			//					_openw.showded = true;
			//					s || _openw.show(a, null, function() {
			//						_openw = null; //避免快速点击打开多个页面
			//					});
			//					s && (_openw = null); //避免s模式下变量无法重置
			//					//		},10);
			//				}, false);
			//				_openw.addEventListener('hide', function() {
			//					_openw && (_openw.showded = true);
			//					_openw = null;
			//				}, false);
			//				_openw.addEventListener('close', function() { //页面关闭后可再次打开
			//					_openw = null;
			//					preate[id] && (preate[id] = null); //兼容窗口的关闭
			//				}, false);
			//			}
			//			return false;
		}
		/**
		 * 获取验证码之后点击事件取消,改变背景和文字
		 * 一分钟之后再次启用
		 */
		function fGetCode() {
			var oCode = document.getElementById("code");
			if (!fCheckPhone()) {
				return;
			}
			var ncode = fCode();
			if (typeof(ncode) == "undefined") {
				fCode();
			} else {
				tcode.value = ncode;
				var ntime = 10;
				oCode.style.backgroundColor = "#D8D8D8";
				oCode.innerHTML = '再次获取' + ntime + 's';
				oCode.onclick = function() {};
				var fSetTime = setInterval(function() {
					ntime--;
					if (ntime == 0) {
						clearInterval(fSetTime);
						oCode.innerHTML = '获取验证码';
						oCode.style.backgroundColor = "#06a863";
						document.addEventListener("click", fGetCode, false);
					} else {
						oCode.style.backgroundColor = "#D8D8D8";
						oCode.innerHTML = '再次获取' + ntime + 's';
					}
				}, 1000);
			}
		}
		//		/**
		//		 * 获取4位随机数(这个方法有可能处出现undefined需要调用玩再去判断)
		//		 */
		//		function fCode() {
		//			var ncode = Math.floor(Math.random() * 10000);
		//			if (ncode > 1000 && ncode < 10000) {
		//				return ncode;
		//			} else {
		//				fCode();
		//			}
		//		}
		//等比显示图片
		var proMaxHeight = 185;
		var proMaxWidth = 175;　　
		function proDownImage(ImgD) {　　　
			var image = new Image();　　　
			image.src = ImgD.src;　　　
			if (image.width > 0 && image.height > 0) {
				var ww = proMaxWidth / image.width;
				var hh = proMaxHeight / image.height;　　　
				var rate = (ww < hh) ? ww : hh;　　
				if (rate <= 1) {　　　
					ImgD.width = image.width * rate;　　
					ImgD.height = image.height * rate;　　
				}　　
				else {　　　　
					ImgD.width = image.width;　　　　
					ImgD.height = image.height;　　　　　
				}　　　
			}
		}
	</script>

	<style type="text/css">
		#tphone {
			width: 60%;
			height: 80%;
			border: none;
			font-size: 16px;
			outline: none;
			-webkit-user-select: text;
			padding: .3em .0em;
			margin: .5em .0em;
		}
		
		#tcode {
			width: 40%;
			height: 80%;
			border: none;
			font-size: 16px;
			outline: none;
			-webkit-user-select: text;
			padding: .3em .0em;
			margin: .5em .0em;
		}
		
		#button {
			outline: none;
			border: none;
		}
	</style>

	<body style="background: #f6f6f8;">
		<div id="dcontent" class="dcontent">
			<form id="plus/order_detail.html" action="plus/order_detail.html" onsubmit="return fClicked(this.id)">

				<div style="text-align: center;background: #f6f6f8;margin-top: 10px;margin-bottom: 30px;">
					<img src="img/mimi/logo.png" align="center" style="height: 154px;width: 130px;" />
				</div>
				<div style="height:20%;background: white;">
					<div class="Splitline " style="margin-top: 10px; "></div>
					<div align="left">
						<img src="img/mimi/ico_phone.png" class="phoneLgoinIco" style="margin-left: 13px;" />
						<input id="tphone" maxlength="11" type="tel" value="18571035397" placeholder="请输入您的手机号" />
					</div>
					<div class="Splitline "></div>
					<div align="left">
						<img src="img/mimi/ico_code.png" class="phoneLgoinIco" style="margin-left: 13px;">
						<input id="tcode" type="password" placeholder="请输入密码" value="070930" /></td>
						<!--<div id="code" class="phoneCode" onclick="fGetCode()">
							获取验证码
						</div>-->
					</div>
					<div class="Splitline "></div>
				</div>

				<input type="submit" style="margin-top: 20px;" class="buttonbig" value="登录" />
			</form>
			<input type="button" style="margin-top: 20px;" class="buttonbig" value="扫码" onclick="clicked('plus/barcode_scan.html',true,true);" />
			<input id="btn_pay" type="button" style="margin-top: 20px;" class="buttonbig" value="支付" onclick="fOpenView('plus/pay.html')">
			<input id="btn_upload" type="button" style="margin-top: 20px;" class="buttonbig" value="上传图片" onclick="fOpenView('plus/upload.html')" />
			<input id="btn_upload" type="button" style="margin-top: 20px;" class="buttonbig" value="压缩图片" onclick="fOpenView('plus/test.html')" />
			<input id="btn_login" type="button" style="margin-top: 20px;" class="buttonbig" value="登陆b端" onclick="fOpenView('plus/login.html')" />
			<input id="btn_location" type="button" style="margin-top: 20px;" class="buttonbig" value="地理定位" onclick="getGeocode()" />
			<input id="btn_test" type="button" style="margin-top: 20px;" class="buttonbig" value="test" onclick="judgePlatform()" />
			<input id="btn_listview" type="button" style="margin-top: 20px;" class="buttonbig" value="listview" onclick="fOpenView('plus/list.html')" />
		</div>

		<div id="output">
			Data Test
		</div>
	</body>

</html>