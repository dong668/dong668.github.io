<!DOCTYPE html>
<html>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta name="HandheldFriendly" content="true" />
	<meta name="MobileOptimized" content="320" />
	<title>Hello H5+</title>
	<script type="text/javascript" src="../js/common.js"></script>
	<link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />
	<script type="text/javascript" src="../js/immersed.js"></script>
	<script type="text/javascript" src="../js/sha1.js"></script>
	<script type="text/javascript" src="../js/utils.js"></script>
	<script type="text/javascript">
		var sUrlParams = "http://dev.mimixiche.cn/api/basic/light_access_token";
		var sHost = "http://dev.mimixiche.cn";
		var sOrder = sHost + "/api/products/orders";
		var oSettings = null;
		var oTelephonyManager = null;
		var oBuild = null;
		var sUnique_id = null;
		var sGetDeviceName = null;
		var sGetOS = null;
		var sIMEI = null;
		var sGetAndroidId = null;
		var responseJson = null;
		var from = 0;
		var count = 10;
		if (window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready",
				function() {
					sGetAndroidId = fGetAndroidId();
					sGetOS = fGetOS();
					//getDeviceName
					sGetDeviceName = fGetDeviceName();
					//获取IMEI
					sIMEI = fGetImeiStatus();
					sUnique_id = fGetDeviceId();
				}, false);
		}

		function plusReady() {
			var oSignature = new Map();
			oSignature.put("username", "18566516064");
			oSignature.put("password", "111111");
			oSignature.put("timestamp", phptime());
			sUrlParams += fGetUrl(oSignature);
			var result = fGetSignature(oSignature);
			sUrlParams += result;
			var oPostParams = new Map();
			oPostParams.put("type", '3');
			oPostParams.put("name", sGetDeviceName);
			oPostParams.put("system", 'Android');
			oPostParams.put("system_version", sGetOS);
			oPostParams.put("imei", sIMEI);
			oPostParams.put("android_id", sGetAndroidId);
			oPostParams.put("unique_id", sUnique_id);
			fPosts(oPostParams, sUrlParams, function(response) {
				responseJson = response;
			});
			sUrlParams = "http://dev.mimixiche.cn/api/basic/light_access_token";
		}

		function fGetOdrder(page) {
			if (responseJson == null) {
				plus.nativeUI.alert("获取订单信息失败！", null, "测试");
			} else {
				saveInfo(responseJson.appid, responseJson.appsecret, responseJson.access_token, responseJson.access_token, 60 * 60)
				var oSignature = new Map();
				//				oSignature.put("appid", responseJson.appid);
				//				oSignature.put("access_token", responseJson.access_token);
				//				oSignature.put("timestamp", phptime());
				oSignature.put("from", '' + from);
				oSignature.put("count", '' + count * page);
				//				sOrder += fGetUrl(oSignature);
				//				oSignature.remove("ver");
				//				oSignature.put("appsecret", responseJson.appsecret);
				//				var result = fGetSignature(oSignature);
				//				sOrder += "signature=" + result;
				httpGet("http://dev.mimixiche.cn/api/products/orders", oSignature, function(response) {
					order(response);
				}, function(error) {});
				fGet(sOrder, function(response) {
					order(response);
				});
				sOrder = sHost + "/api/products/orders";
			}
		}

		function order(response) {
			var orderTable = document.getElementById('order');
			var foot = document.getElementById("foot");
			var aorders = response.orders;
			for (var i in aorders) {
				var tr = document.createElement('tr');
				tr.id = aorders[i].barcode;
				tr.setAttribute('onclick', 'pay(this.id)');
				var tdId = document.createElement('td');
				tdId.innerText = aorders[i].barcode;
				var tdShop = document.createElement('td');
				tdShop.innerText = aorders[i].shop.name;
				var tdMoney = document.createElement('td');
				tdMoney.setAttribute("class", "money");
				tdMoney.setAttribute("align", "center");
				tdMoney.innerText = aorders[i].trade_sum;
				var tdAddress = document.createElement('td');
				tdAddress.setAttribute("align", "center");
				tdAddress.innerText = aorders[i].delivery.region.address;
				var tdStatus = document.createElement('td');
				tdMoney.setAttribute("class", "money");
				tdStatus.setAttribute("align", "center");
				//状态:1-已提交;2-已支付;3-待出库;4-已出库;5-配送中;6-完成配送;7-结算;10-已退款;100-已取消;200-已完成
				var Status = "";
				switch (aorders[i].status) {
					case 1:
						Status = "已提交";
						break;
					case 2:
						Status = "已支付";
						break;
					case 3:
						Status = "待出库";
						break;
					case 4:
						Status = "已出库";
						break;
					case 5:
						Status = "配送中";
						break;
					case 6:
						Status = "完成配送";
						break;
					case 7:
						Status = "结算";
						break;
					case 10:
						Status = "已退款";
						break;
					case 20:
						Status = "待客服确认";
						break;
					case 21:
						Status = "待取车";
						break;
					case 22:
						Status = "已取车";
						break;
					case 23:
						Status = "施工中";
						break;
					case 24:
						Status = "正在还车";
						break;
					case 25:
						Status = "已收车";
						break;
					case 26:
						Status = "定损";
						break;
					case 27:
						Status = "施工完成";
						break;
					case 100:
						Status = "已取消";
						break;
					case 200:
						Status = "已完成";
						break;
				}
				tdStatus.innerText = Status;
				var tdLogTime = document.createElement('td');
				tdLogTime.setAttribute("align", "center");
				tdLogTime.innerText = fFormatDate(aorders[i].created * 1000);
				tr.appendChild(tdId);
				tr.appendChild(tdShop);
				tr.appendChild(tdMoney);
				tr.appendChild(tdAddress);
				tr.appendChild(tdStatus);
				tr.appendChild(tdLogTime);
				orderTable.appendChild(tr);
			}
			//foot.innerText = response.total;
		}

		function pay(id) {}

		function fSeachData() {
			var payWay = document.getElementById("payWay");
			var orderStatus = document.getElementById("orderStatus");
			var payWayIndex = payWay.selectedIndex;
			//var payWayText = payWay.options[index].text;
			var payWayValue = payWay.options[payWayIndex].value;
			var orderStatusIndex = payWay.selectedIndex;
			//var payWayText = payWay.options[index].text;
			var orderStatusValue = payWay.options[orderStatusIndex].value;
			if (responseJson == null) {
				plus.nativeUI.alert("获取订单信息失败！", null, "测试");
			} else {
				var oSignature = new Map();
				oSignature.put("appid", responseJson.appid);
				oSignature.put("access_token", responseJson.access_token);
				oSignature.put("timestamp", phptime());
				oSignature.put("from", '' + from);
				oSignature.put("count", '' + count);
				oSignature.put("ver", '39');
				sOrder += fGetUrl(oSignature);
				oSignature.remove("ver");
				oSignature.put("appsecret", responseJson.appsecret);
				var result = fGetSignature(oSignature);
				sOrder += result;
				fGets(sOrder, payWayValue, orderStatusValue, function(response) {
					order(response);
				});
				sOrder = sHost + "/api/products/orders";
			}
		}
	</script>

	<body>
		<header id="header">
			<div class="nvbt iback" onclick="back(true);"></div>
			<div class="nvtt">login</div>
		</header>
		<div id="dcontent" class="dcontent">
			<input type="button" style="margin-top: 20px;" class="buttonbig" value="登陆b端" onclick="plusReady()" />
			<input type="button" style="margin-top: 20px;" class="buttonbig" value="获取订单的信息" onclick="fGetOdrder(1)" />
			<input type="button" style="margin-top: 20px;" class="buttonbig" value="搜索" onclick="fSeachData()" />
			<input type="button" style="margin-top: 20px;" class="buttonbig" value="下一页" onclick="fGetOdrder(1)" />
			<input type="button" style="margin-top: 20px;" style="font-size: 48px;" value="下一页" onclick="fGetOdrder(1)" />
			<p style="font-size: 20px;">This is a paragraph</p>
			<div style="height:30px;margin-left:5px;" align="left">
				搜索:<input id="seachKeys" type="search" placeholder="订单号" style=" color: black; font: 18px;margin-top: 5px;" />
			</div>
			<div style="margin-left:5px; width: 100%;" align="left">
				支付方式:
				<select id="payWay" style="height: 25px;margin-bottom: 10px; width: 25%;">  
							<option value ="0">全部方式</option> 
  							<option value ="1">在线</option>  
  							<option value ="2">用户卡</option>  
  							<option value ="3">零钱</option>  
  							<option value ="4">货到付款</option>  
  						    <option value ="5">现金</option> 
  							<option value ="6">刷卡</option> 
				</select> 订单状态:
				<select id="orderStatus" style="height: 25px;margin-bottom: 10px;width: 25%;">  
							<option value ="0">全部状态</option> 
  							<option value ="1">已提交</option>  
  							<option value ="2">待结算 </option>  
  							<option value ="3">已退款</option>  
  							<option value ="4">带客服确认</option>  
  						    <option value ="5">待取车</option> 
  							<option value ="6">已取车</option>
  							<option value ="7">施工中</option> 
  							<option value ="8">还车中</option>
  							<option value ="9">已取消</option> 
  							<option value ="10">已完成</option>
					</select>
			</div>
			<div style="overflow-x: hidden;	overflow-y: scroll;	-webkit-overflow-scrolling: touch;">
				<table style="margin-top: 20px;" id="order" width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#d8d8d8">
					<tr>
						<td align="center">订单号</td>
						<td align="center">商户名称</td>
						<td align="center">金额</td>
						<td align="center">地址</td>
						<td align="center">状态</td>
						<td align="center">创建时间</td>
					</tr>
				</table>
				<div id="foot">

				</div>
			</div>
		</div>

	</body>

</html>