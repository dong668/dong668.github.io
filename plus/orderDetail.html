<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>员工端－保养订单详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

		<link id="android" rel="stylesheet" type="text/css" charset="utf-8" href="../css/style.css" />
		<link rel="stylesheet " href="../css/common.css " type="text/css " charset="utf-8" />
		<link rel="stylesheet" href="../css/layer.css" type="text/css" charset="utf-8" />

		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/jquery-1.11.0.js"></script>
		<script type="text/javascript" src="../utilsJs/constant.js"></script>
		<script type="text/javascript" src="../utilsJs/map.js"></script>
		<script type="text/javascript" src="../utilsJs/httpUtils.js"></script>
		<script type="text/javascript" src="../utilsJs/sha1.js"></script>
		<script type="text/javascript" src="../utilsJs/utils.js"></script>
		<script type="text/javascript" src="../utilsJs/showView.js"></script>
		<script type="text/javascript" src="../utilsJs/layer.js"></script>
		<script type="text/javascript" src="../utilsJs/jquery.qrcode.min.js"></script>
		<script type="text/javascript" src="../utilsJs/dpHttp.js"></script>
		<style type="text/css">
			.headerText {
				font-size: 0.18rem !important;
				text-align: center !important;
			}
			
			.OrderDetail {
				width: 80%;
				margin-top: 0.44 rem;
			}
		</style>
		<script type="text/javascript">
			window.utilsJs = null;
			window.order = null;
			window.constantValues = null;
			window.shwoView = null;
			window.dpHttp = null;
			window.httpUtils = new HttpUtils();

			window.addEventListener('refreshOrderInfo', function() {
				ApiConfig.staticIsDebug(null, 'refreshOrderInfo');
				shwoView.refreshOrderInfo();
			});
			window.addEventListener('Search', function() {
				if($('#layer_root').length == 0) {
					layerOpen({
						"title": "查询用户特权",
						"content": '<input id="key_id" type="text" placeholder="请输入车牌号" value="京N0Z455" style ="margin-left: 0.14rem;outline: none;font-size: 0.16rem;-webkit-user-select: text"/>',
						"btn": ["取消", "查询"],
						"shadeClose": true,
						"event": [null, function() {
							var key_id = document.getElementById('key_id');
							if(key_id.value.length > 0) {
								var re = /^[\u4e00-\u9fa5]{1}[A-Z]{1}[A-Z_0-9]{5}$/;
								if(key_id.value.search(re) == -1) {
									ApiConfig.staticShowToast('输入的车牌号格式不对');
								} else {
									dpHttp.userPrivileges(key_id.value, function(responseJson) {
										if(responseJson.user_privileges) {
											var user_privileges = responseJson.user_privileges;
											if(user_privileges.effective_from.sec > httpUtils.phptimeInt) {
												ApiConfig.staticShowToast('刮蹭宝还未生效----生效时间：' + utilsJs.formatDay(user_privileges.effective_from.sec * 1000));
											} else {
												if(user_privileges.expires.sec > httpUtils.phptimeInt) {
													ApiConfig.staticShowToast('刮蹭宝已过期----过期时间' + utilsJs.formatDay(user_privileges.effective_from.sec * 1000));
												} else {
													ApiConfig.staticShowToast('可以正常使用刮蹭宝截止时间' + utilsJs.formatDay(user_privileges.effective_from.sec * 1000));
												}
											}
										} else {
											ApiConfig.staticShowToast('该车牌号未绑定刮蹭宝');
										}
									}, function(errorJson) {

									});
								}
							} else {
								ApiConfig.staticShowToast('请输入车牌号');
							}
						}]
					});
				}
			});

			function plusReady() {
				$('.layer_root').css('margin-top', '0px');
				switch(plus.os.name) {
					case "Android":
						$('#android').attr('href', '../css/style.css');
						break;
					case "iOS":
						$('#android').attr('href', '../css/ios.css');
						break;
				}
				utilsJs = new Utils();
				constantValues = new ConstantString();
				dpHttp = new DpHttp(utilsJs, httpUtils);
				// 查找应用首页窗口对象
				var orderInfo = plus.webview.getWebviewById('orderDetail');
				order = orderInfo.order;
				shwoView = new ShowView(order, utilsJs, constantValues, dpHttp);
				shwoView.showOrderInfo();
				shwoView.showOrderStauts();
				document.getElementById('refresh').addEventListener('tap', function() {
					ApiConfig.staticIsDebug(null, 'refresh');
					shwoView.refreshOrderInfo();
				});
				document.getElementById('closeWin').addEventListener('tap', function() {
					mui.back();
				});

			}

			if(window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", plusReady, false);
			}
		</script>
	</head>

	<body>
		<header id="header" class="loginHeader" style="line-height:0.44rem;text-align:center;">
			<div class="nvbt iback" id="closeWin"></div>
			订单详情
			<b id='refresh' style="font-weight:normal;margin-right:0.1rem;" class="right">刷新</b>
		</header>
		<div id="bpOrderDetails" class="bpOrderDetails">
			<div id="div_order" class="orderStatus1" style="margin-top: 0.44rem;">
			</div>
		</div>

	</body>

</html>
<script type="text/javascript">
	document.documentElement.style.fontSize = document.documentElement.clientWidth / 3.75 + "px";
</script>